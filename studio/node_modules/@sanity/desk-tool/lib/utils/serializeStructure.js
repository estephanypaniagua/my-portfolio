"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = serializeStructure;

var _rxjs = require("rxjs");

var _operators = require("rxjs/operators");

var _typePredicates = require("./typePredicates");

function serializeStructure(child, context, resolverArgs) {
  // Lazy
  if (typeof child === 'function') {
    return serializeStructure(child(...resolverArgs), context, resolverArgs);
  } // Promise/observable returning a function, builder or plain JSON structure


  if ((0, _typePredicates.isSubscribable)(child)) {
    return (0, _rxjs.from)(child).pipe((0, _operators.mergeMap)(val => serializeStructure(val, context, resolverArgs)));
  } // Builder?


  if ((0, _typePredicates.isSerializable)(child)) {
    return serializeStructure(child.serialize(context), context, resolverArgs);
  } // Plain value?


  return (0, _rxjs.of)(child);
}